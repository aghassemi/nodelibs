var u=require("./util"),write=u.write,fill=u.zeroFill;module.exports=function(e){function t(t,r){this._block=new e(t),this._finalSize=r,this._blockSize=t,this._len=0,this._s=0}function r(e,t){return null==t?e.byteLength||e.length:"ascii"==t||"binary"==t?e.length:"hex"==t?e.length/2:"base64"==t?e.length/3:void 0}return t.prototype.init=function(){this._s=0,this._len=0},t.prototype.update=function(t,n){var i,o=this._blockSize;n||"string"!=typeof t||(n="utf8"),n?("utf-8"===n&&(n="utf8"),("base64"===n||"utf8"===n)&&(t=new e(t,n),n=null),i=r(t,n)):i=t.byteLength||t.length;for(var s=this._len+=i,u=this._s=this._s||0,a=0,_=this._block;s>u;){var f=Math.min(i,a+o);write(_,t,n,u%o,a,f);var h=f-a;u+=h,a+=h,u%o||this._update(_)}return this._s=u,this},t.prototype.digest=function(e){var t=this._blockSize,r=this._finalSize,n=8*this._len,i=this._block,o=n%(8*t);i[this._len%t]=128,fill(this._block,this._len%t+1),o>=8*r&&(this._update(this._block),u.zeroFill(this._block,0)),i.writeInt32BE(n,r+4);var s=this._update(this._block)||this._hash();return null==e?s:s.toString(e)},t.prototype._update=function(){throw new Error("_update must be implemented by subclass")},t};